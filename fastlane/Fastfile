$devices_ios = ["iPhone Xs Max"]
$devices_android = ""

platform :ios do
  lane :tests do
    swiftlint(
      path: "ios/SwiftKotlination"
    )
    run_tests(
      devices: $devices_ios, 
      clean: true, 
      code_coverage: true, 
      project: "ios/SwiftKotlination/SwiftKotlination.xcodeproj"
    )
  end

  lane :screenshots do
    capture_ios_screenshots(
      devices: $devices_ios, 
      clear_previous_screenshots: true, 
      project: "ios/SwiftKotlination/SwiftKotlination.xcodeproj"
    )
  end
end

platform :android do
  lane :tests do
    sh("curl -sSLO https://github.com/shyiko/ktlint/releases/download/0.33.0/ktlint")
    sh("chmod a+x ktlint")
    sh("./ktlint ../android/SwiftKotlination/app/src/**/*.kt")
    sh("rm ./ktlint")
    build_android_app(
      task: "clean jacocoTestReport", 
      project_dir: "android/SwiftKotlination"
    )
  end

  lane :screenshots do
    build_android_app(
      task: 'clean', 
      project_dir: "android/SwiftKotlination"
    )
    build_android_app(
      task: 'assemble',
      build_type: 'Debug', 
      project_dir: "android/SwiftKotlination"
    )
    build_android_app(
      task: 'assemble',
      build_type: 'AndroidTest', 
      project_dir: "android/SwiftKotlination"
    )
    capture_android_screenshots(
      clear_previous_screenshots: true,
      app_package_name: "fr.jhandguy.swiftkotlination", 
      app_apk_path: "android/SwiftKotlination/app/build/outputs/apk/debug/app-debug.apk", 
      tests_apk_path: "android/SwiftKotlination/app/build/outputs/apk/androidTest/debug/app-debug-androidTest.apk",
      test_instrumentation_runner: "fr.jhandguy.swiftkotlination.runner.AndroidTestRunner"
    )
  end
end
